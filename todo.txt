format code
fix undo
fix recording